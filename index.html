<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raycasting Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white">
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold mb-4">Raycasting Engine Demo</h1>
        <canvas id="gameCanvas" width="800" height="600" class="border border-gray-700"></canvas>
    </div>
    <script>
        class RaycastingEngine {
            constructor(canvas, map, textures) {
                this.canvas = canvas;
                this.context = canvas.getContext('2d');
                this.map = map;
                this.textures = textures;
                this.width = canvas.width;
                this.height = canvas.height;
                this.fov = Math.PI / 3; // Field of view
                this.maxDepth = 20;
            }

            castRay(angle, posX, posY, dirX, dirY) {
                let sin = Math.sin(angle);
                let cos = Math.cos(angle);
                let distance = 0;
                let hit = false;
                let wallX;

                while (!hit && distance < this.maxDepth) {
                    distance += 0.1;
                    let x = posX + cos * distance;
                    let y = posY + sin * distance;

                    if (this.map[Math.floor(y)][Math.floor(x)] > 0) {
                        hit = true;
                        wallX = x;
                    }
                }

                return { distance, wallX };
            }

            render(posX, posY, dirX, dirY) {
                this.context.clearRect(0, 0, this.width, this.height);

                for (let i = 0; i < this.width; i++) {
                    let angle = (i / this.width - 0.5) * this.fov;
                    let ray = this.castRay(angle, posX, posY, dirX, dirY);
                    let distance = ray.distance * Math.cos(angle); // Correct fisheye effect
                    let wallHeight = Math.min(this.height / distance, this.height);

                    this.context.fillStyle = 'gray';
                    this.context.fillRect(i, (this.height - wallHeight) / 2, 1, wallHeight);
                }
            }
        }

        const canvas = document.getElementById('gameCanvas');
        const map = [
            [1, 1, 1, 1, 1, 1, 1, 1],
            [1, 0, 0, 0, 0, 0, 0, 1],
            [1, 0, 0, 0, 0, 0, 0, 1],
            [1, 0, 0, 0, 0, 0, 0, 1],
            [1, 0, 0, 0, 0, 0, 0, 1],
            [1, 0, 0, 0, 0, 0, 0, 1],
            [1, 0, 0, 0, 0, 0, 0, 1],
            [1, 1, 1, 1, 1, 1, 1, 1]
        ];
        const textures = {}; // Placeholder for textures

        const engine = new RaycastingEngine(canvas, map, textures);

        let posX = 3.5;
        let posY = 3.5;
        let dirX = -1;
        let dirY = 0;

        function gameLoop() {
            engine.render(posX, posY, dirX, dirY);
            requestAnimationFrame(gameLoop);
        }

        gameLoop();
    </script>
</body>
</html>